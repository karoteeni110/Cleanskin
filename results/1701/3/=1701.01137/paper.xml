<?xml version="1.0" encoding="UTF-8"?>
<opml version="2.0">
  <head>
    <title>An architecture for efficient gravitational wave parameter estimation
with multimodal linear surrogate models</title>
    <abstract>The recent direct observation of gravitational waves has further
emphasized the desire for fast, low-cost, and accurate methods to infer
the parameters of gravitational wave sources. Due to expense in waveform
generation and data handling, the cost of evaluating the likelihood
function limits the computational performance of these calculations.
Building on recently developed surrogate models and a novel parameter
estimation pipeline, we show how to quickly generate the likelihood
function as an analytic, closed-form expression. Using a straightforward
variant of a production-scale parameter estimation code, we demonstrate
our method using surrogate models of effective-one-body and numerical
relativity waveforms. Our study is the first time these models have been
used for parameter estimation and one of the first ever parameter
estimation calculations with multi-modal numerical relativity waveforms,
which include all modes. Our grid-free method enables rapid parameter
estimation for any waveform with a suitable reduced-order model. The
methods described in this paper may also find use in other data analysis
studies, such as vetting coincident events or the computation of the
coalescing-compact-binary detection statistic. </abstract>
  </head>
  <body>
<outline text="Introduction" _note="On September 14, 2015, at 09:50:45 UTC, the Laser Interferometer Gravitational-Wave Observatory (LIGO) made the first direct observation of a gravitational-wave signal from two coalescing black hole binaries . By systematically comparing the signal against approximations to the solutions of Einstein’s equations, the properties of the coalescing black hole binary were inferred . Similar binary black hole systems will be detected in coming years , at a rate of up to one per day by advanced LIGO and Virgo. These discoveries will revolutionize our understanding of astrophysics (see, e.g., Refs.  and references therein) and provide tests of gravitational theory to unprecedented accuracies in the regime of strong-field dynamics with relativistic velocities .  The vigorous pace of discovery, combined with the tantalizing opportunities afforded by low-latency and coordinated multimessenger observations , demand equally rapid inference: LIGO and its electromagnetic partners should prepare to reliably reconstruct the source parameters of coalescing binaries as fast as possible . Especially when using the best-available waveform models, these calculations can be very costly; see, e.g., .  Several strategies have been developed to reduce the computational cost of parameter estimation . Approaches that have appeared in the literature include generating the approximate solutions more quickly ; interpolating some combination of the waveform or likelihood ; or adopting a sparse representation to reduce the computational cost of data handling . Some methods, however, achieve rapid turnaround through simplifying approximations. Two rapid strategies eschew significant approximation: reduced-order models (ROMs), a term we shall use interchangeably with surrogate models, and refactored likelihoods.  A surrogate model provides an efficient and highly accurate representation for the gravitational wave strain. Surrogate models have been applied to reproduce the radiation from complicated sources, including long duration signals , arbitrarily many harmonic modes , spinning binary systems , precessing binary systems , and neutron star models with tidal effects . Moreover, as we describe in this paper, calculations that arise naturally in parameter estimation studies can be expressed in terms of simple, precomputed quantities constructed from the reduced-order representation. The result is a dramatic reduction in the number and complexity of operations needed to carry out gravitational-wave inference. Similarly, Pankow et al. (henceforth [ILE]{}, a shorthand for “integrate likelihood over the extrinsic parameters”) expressed the gravitational-wave strain using the natural basis provided by a spin-weighted spherical harmonic decomposition of the waves. By almost eliminating overhead from data handling (e.g., the cost of performing Fourier transforms and inner products needed to evaluate ), this representation allows for rapid likelihood evaluations, enabling direct Monte Carlo integration over all “fast” variables (e.g., extrinsic parameters corresponding to the spacetime location and orientation of the binary, which leave the binary’s intrinsic dynamics unchanged). The ILE framework was recently applied in , to directly compare GW150914 against numerical simulations of Einstein’s equations, without any intermediate approximation.  In this work, we demonstrate that these two approaches can and should be naturally unified, dramatically enhancing overall performance. This combination increases the performance of [ILE]{} by removing the need for a brute-forced grid-based exploration of the intrinsic parameter space, which can be a source of error. Additionally, we present the first parameter estimation results using multimodal numerical relativity surrogates.  This paper is organized as follows. In Section   we introduce the likelihood calculation (Section  ), describe how to refactor the log-likelihood for efficient use of reduced-order gravitational-wave models (Section  ), and implement our procedure as a simple extension of an existing, production scale parameter estimation pipeline by interfacing this pipeline with low-level surrogate data-access tools (Section  ). Section   demonstrates the method using end-to-end comparisons with the traditional [ILE]{} framework. For simplicity and to facilitate illustrations and comparisons, we emphasize examples using a previously-reported and widely available nonspinning, comparable-mass effective-one-body (EOB) surrogate [^1] provides the exact code snapshot of LAL at the time the surrogate was built. and a nonspinning numerical relativity surrogate model  including harmonic modes up to and trained on a mass ratio interval of , where and are the binary’s component masses.  [^1]:  This surrogate model, which is distributed with the     `gwsurrogate` package , was built for the EOB model described in     Ref.  and implemented in the routine EOBNRv2 as part of the publicly     available LIGO Analysis Library (LAL) Suite. The git hash     59c12886b026c863397f191e6c2ca69ef3498616 (available, e.g., at     `https://github.com/lscsoft/lalsuite`)">
</outline>
<outline text="Methods">
  <outline text="Inference by (Monte Carlo) integration">
    <outline text="Preliminaries" _note="Given a value of the intrinsic parameters (eight parameters characterizing the two masses and spin vectors) and extrinsic parameters (four spacetime coordinates for the coalescence event; three Euler angles for the binary’s orientation relative to the Earth), we can predict the response of LIGO’s two operational instruments, denoted as , to an impinging gravitational wave signal. Assuming a Gaussian, stationary noise model, we can evaluate the log-likelihood of LIGO’s network of observatories having recorded a gravitational wave signal. Except for the overall normalization constant, and omitting calibration uncertainty, our expression  agrees with Eq. (1) in . Here is the detector data in instrument , is a noise-weighted inner product implied by the th-detector’s noise power spectrum , is the Fourier transform of , denotes complex conjugation of , and is frequency; see, e.g., for more details. In practice, and as discussed in the next section, we adopt a low-frequency cutoff such that all inner products are modified to  A key task of any parameter estimation study is to compute the joint posterior probability of which follows from Bayes’ theorem. Here and are priors on the (independent) variables .[^1]  [^1]: For simplicity, we assume all binary black hole systems are     equally likely anywhere in the universe, at any orientation relative     to the detector. Future direct observations may favor a correlated     distribution, including the formation of more massive black holes at     larger redshift .">
    </outline>
    <outline text="Fast and slow intrinsic parameters" _note="Following , we partition the intrinsic parameter into “fast” and “slow” parameters denoted by and , respectively. In principle, this division depends entirely on the computational cost of waveform generation. “Fast&quot; parameters are those for which new waveform evaluations can be quickly generated from existing ones as the value of changes. Typically, this is accomplished by an explicit, closed-form expression. In the original ILE study , the fast (slow) parameters were the extrinsic (intrinsic) parameters. By contrast, for this paper, and as we show for any other ILE-based investigation using linear surrogates that represent the scale-free general relativity solution, the only “slow” parameter is the binary system’s total mass . Having split the intrinsic parameters into a fast and slow set, we shall now view the likelihood function as . For a fixed value of , integration over all fast parameters leads to an intermediate result[^1]: Note that unlike in the original ILE framework, we have explicitly retained the prior in this expression. For the [ILE]{} study , included all intrinsic parameters, with being empty. In that work, a function proportional to was evaluated on a grid; interpolated, fitted, or otherwise approximated; and hence used to generate the posterior as a function of which follows by integrating Eq. ( ) over and .[^2] The denominator of this quantity, the (Bayesian) evidence for our model, can be used to assess how well our model fits the data. The ILE grid-based design was intended to minimize the severe computational cost of evaluating waveforms at different values of . In Sec.  , we show how linear surrogate models remove any need for expensive, high-dimensional grids. If the integral appearing in Eq.  is performed by direct Monte Carlo integration, and this computation is repeated on a dense and uniform grid in (here, , the total binary mass), the posterior may be estimated using a fit-free method. ILE used this same method – henceforth denoted ILEMC – to infer posterior distributions in . Assuming we have random samples drawn from a sampling distribution at fixed value of , then the numerical approximation to the true marginalized likelihood computed by Monte Carlo integration is:     We repeat this process for a uniform grid in , using the same number of samples, N, each time. As a result and in particular, we can estimate the true one-dimensional cumulative distribution by the numerical approximation : i.e., by a Monte Carlo integral over the interval . Here can be any parameter in or , indexes the Monte Carlo samples over the union of all of the values of , refers to the value of parameter for the th sample, and is the Heaviside step function. Using higher-dimensional weighted density estimates (e.g., kernel density estimators or weighted histograms), we can likewise estimate the joint posterior distribution in any set of dimensions, with sufficiently dense sampling.  [^1]: In general the prior in will not be separable: the range of     allowed mass ratios will depend on total mass, for example.  [^2]: Note that in this expression (and in contrast to the notation in     ), our expression for includes the prior over , allowing us to     employ the same expression for the posterior to describe the method     used in this work and in .">
    </outline>
  </outline>
  <outline text="Refactored likelihood for linear surrogates">
    <outline text="Surrogate-enabled ILE" _note="A complex gravitational-wave strain can be expressed in terms of its two fundamental polarizations and . Here, denotes time, and are the polar and azimuthal angles for the direction of gravitational wave propagation away from the source. The complex gravitational-wave strain can be written in terms of spin-weighted spherical harmonics as where the sum includes all harmonic modes made available by the model; where is a fiducial reference distance; and where , the luminosity distance to the source, is one of the extrinsic parameters.  Following a standard ROM prescription, we assume access to a [LINEAR]{} surrogate model for each harmonic mode associated with some fiducial distance , which can be expressed as a [LINEAR]{} expansion in a set of reduced basis functions . Different surrogate modeling techniques prescribe different approaches for the coefficients – these details need not concern us here. Crucially, this decomposition naturally identifies the “fast” and “slow” intrinsic parameters. Since the time and total mass are coupled through the basis functions, , we are unable to “pull&quot; out of the inner products (cf. Eq. ); computing the likelihood for new values of will require the computation of many slow overlap integrals. Conversely, as the remaining intrinsic parameters only enter through the expansion coefficients, , computing the likelihood for new values of is accomplished with fast evaluations of these coefficients (cf. Eq. ). This approach requires that the coefficients are given by a known, closed-form expression and the model’s temporal and parametric dependence has an affine factorization of Eq. . In particular, this restriction precludes surrogate models whose temporal dependence has a [NON-LINEAR]{} relationship to the basis (say, by an amplitude and phase decomposition). As described later on, we do not believe this to be any real restriction in practice since all surrogates can be brought into the form . Indeed, the numerical relativity surrogate model used in this paper , expressed as two independent linear expansions of the amplitude and phase of each mode , was originally in a format incompatible with the representation .  Following , we substitute expression  for into the expression for the detector response , where is the arrival time at the th detector (at position ) for a plane wave propagating along and is the time of coalescence . We then substitute these expressions for into the likelihood function  thereby generating   where where are the complex-valued detector response functions of the th detector and the quantities depend on and the data as     Finally, substituting  into while fixing the value of , we find that all three parameter-dependent functions can be expressed in terms of the surrogate interpolating functions, , and correlations between the reduced basis functions and data:     Here is a time-translation operator . In other words, after a handful of inner product evaluations that can be computed once and for all, the likelihood can be subsequently evaluated for all intrinsic parameters ANALYTICALLY, as are known analytic expressions (made directly available by the surrogate model) and are easily tabulated arrays.">
    </outline>
    <outline text="Discussion and further compression" _note="Equation  needs to be evaluated for each basis function in the surrogate model. Current multimodal surrogates (including the surrogates employed here) treat each mode independently, so the total number of basis functions grows with the number of modes as well as the number of basis functions per mode. For example, in some of our parameter estimation studies we use a non-spinning NR surrogate that contains modes and about basis per mode, implying an enormous number of inner products .  The basis size can be reduced three ways. Our procedure follows a combination of the first two observations described below; we hope to explore the final approach (which requires building a new surrogate model) in future work.  First, we can eliminate superfluous modes from our expansion; for example, the mode is rarely practically relevant (i.e., ; cf. the caption of Fig.  ). Our ILE implementation automatically eliminates modes which are unlikely to be relevant, based on a reference set of parameters provided by the gravitational wave search. Second, we can easily reduce the number of basis elements needed per mode. As shown in Fig.  , surrogate errors typically converge exponentially and employ an excessively accurate basis (often with overlap errors around ) for parameter estimation purposes. So the basis size can be reduced by as much as a factor of 2 in our case without a significant loss in accuracy.[^1] To be concrete, Eq.  can be expressed in terms of orthogonal basis functions, , which are related to the basis functions, , by a linear transformation, . The transformation matrix is a necessary part of the surrogate building process  and is readily available for use by the ILE codes. In the orthogonal representation, the basis elements are ordered by significance; we can therefore dramatically reduce the number of basis elements needed, by adopting a basis size suitable to the comparatively lower accuracy needed for our calculations. For simplicity and modularity, however, our current implementation uses Eq. ( ) directly, without additional refactoring. Instead, our current implementation can drop higher-order (orthogonal) basis functions before the computation of and hence Eq. .  Finally, we can reduce the overall set of by using another surrogate construction procedure, employing the same basis set for all the modes. This straightforward second-generation surrogate should require fewer basis coefficients, particularly since modes with the same harmonic index share similar frequency content at early times.  [^1]: To assess just how excessively accurate these surrogate model     constructions can be, we compare the typical accuracy shown in Fig.     ( ) to the largest mismatch error that     could introduce a significant deviation into a parameter estimation     posterior: an overlap error of order . This nominal overlap error is     also often significantly smaller than other systematic effects     associated with intrinsic NR error due to finite resolution and     extraction, as well as to effects associated with the neglect of     higher-order modes.">
    </outline>
    <outline text="Implementation considerations" _note="Our approach requires the surrogate model to be expressed as a linear combination of basis elements. However, not all surrogates have this form. For example, some models are built to separately reconstruct the amplitude and phase of see, e.g., . That said, any surrogate can be used to train a secondary “surrogate-of-a-surrogate&quot; that has the necessary form given by Eq. . We have found that building a secondary surrogate is significantly easier than the original surrogate since (i) the waveform training data is already aligned  [^1] and (ii) arbitrarily many waveform evaluations can be supplied by the primary surrogate. Moreover, several modern surrogates are already expressed in as a linear combination of basis to enable their use in reduced-order-quadrature methods . Our method can therefore be applied to all available surrogates without loss of generality.  As described in , the `gwsurrogate` package  provides an interface to generic surrogates for gravitational wave radiation from coalescing binaries. As part of this paper, we have extended gwsurrogate’s API to allow for a convenient interface with low level surrogate waveform data as needed by the surrogate-enabled ILE pipeline. In this work we will demonstrate our method using one of the surrogates provided with it: a zero-spin, equal-mass surrogate tuned to the nonspinning effective-one-body model . For each total mass , we can extract the basis functions and construct the inner products appearing in Eq. ( ), once and for all. To evaluate the likelihood any mass ratio and extrinsic parameters , we use the [ILE]{} likelihood  )\], where are evaluated using Eq. ( ) and the coefficients are provided by our surrogate model.  [^1]: In our case, the initial surrogate was aligned so that the maximum     of occurs at ; see Eq. (2) in Ref. .">
    </outline>
  </outline>
  <outline text="Two methods to infer parameters" _note="In Sec.   we will directly compare two ILE-type approaches to infer parameters: traditional ILE  and its extension developed here. While both methods have been presented for generic binary black hole systems, the parameter estimation results of Sec.   are for non-spinning binaries. And so, for concreteness, we briefly summarize these methods when specialized to such systems.  **Traditional ILE.** We use ILE to (i) evaluate by direct Monte Carlo integration, (ii) fit this function, as  [^1], and then (iii) integrate to evaluate the posterior.  In contrast to given by Eq. , which is a function only of the total binary mass and which in this work is used only for normalization, the function depends on all intrinsic binary parameters .  We perform the integration carried out in the third step via Monte Carlo, using a uniform prior density in such that each component mass is greater than and the total mass is less than . The prior’s boundary is defined by a right triangle with verticies at , , and \], so in this region . In an coordinate system, in the region consistent with our constraints this prior has the form . The extra factor of 2 arises by compressing the two regions and into a single region in the plane (i.e., by requiring or .) **ILEMC.** In the new approach described in this paper, we perform the Monte Carlo procedure described in Eq. ( ) for a dense and uniform grid in total mass (). One-dimensional posterior distributions are found via Eq.( ).  To be concrete, in Sec.   our numerical experiment will be to (i) generate a specific list of candidate signals, (ii) prepare mock data for the expected LIGO response, and finally (iii) apply the traditional ILE and ILEMC procedures to these synthetic datasets. We assume both instruments operate at the LIGO O1 sensitivity . We analyze data segments of 32s in duration sampled at a rate of Hz. Our candidate signals are nonspinning black hole binaries, with an inclination of (in the first case) or (in the remaining cases) relative to the line of sight, and with the distance D scaled so the network signal-to-noise ratio is or . For simplicity, all candidate signals have been generated with a multimodal effective-one-body model for nonspinning binary black holes , henceforth denoted EOBHM. The EOB surrogate model used in this paper has been trained on EOBHM , but for signal injection we continue to use the original EOBHM model. The original EOBHM model is also used for parameter estimation with the traditional ILE method while the ILEMC will always use the surrogate model in its analysis. The likelihood calculation uses frequencies between and . A template’s duration depends on the model. For EOBHM, the (2,2) mode starts at , to insure mode starts before 20 [ [Hz]{}]{}. For the ROM, the entire dimensionless surrogate model is used when computing Eq.  so the starting frequency depends on the binary mass; for a sense of scale, at and , the mode has a starting frequency of roughly .  [^1]: To ensure robust results, we have employed both low-order     polynomial and Gaussian process fits; our results do not change     significantly (i.e., the average difference between two cumulative     distribution function estimates is a few percent over the interval     shown in our figures).">
  </outline>
</outline>
<outline text="Demonstrations" _note="Figures   and   compare results obtained by traditional ILE and ILEMC applied to identical sources, summarized in Table  , using a range of candidate models that may include or omit higher order modes. Section   provides a complete description of the demonstration’s setup.">
  <outline text="Single mode, non-spinning EOB surrogate model" _note="Figure   shows two cumulative posterior distributions from a parameter estimation study performed on a synthetic dataset with source parameters (entry ID 0) summarized in Table   – a configuration motivated by the parameters of GW150914 . The solid red curve shows the posterior distribution recovered with traditional ILE and the EOBHM model. The green curve shows the results derived from our new ILEMC approach and a surrogate trained to reproduce the mode of EOBHM. Despite the surrogate model ignoring higher harmonic mode content we expect these two methods to produce nearly-identical posteriors. Indeed, this choice of inclination angle and mass ratio is well known to minimize the importance of higher modes. For nearly equal-mass binaries at this relatively low total mass, previous studies have shown higher harmonics have negligible impact on parameter estimation; see, e.g., .  As expected, the red (traditional ILE) and green (ILEMC) curves nearly agree. The discrete steps apparent in the ILEMC posterior (green) arise because of the Monte Carlo procedure used to estimate the cumulative; by contrast, the smooth results produced by traditional ILE follow from applying a simple approximation to the function . In , this approximation was a second-order Taylor series approximation near the peak; in , this approximation was an interpolating function based on a discrete sampling grid. Here, we have compared parameter estimation (PE) with and without surrogates, using a surrogate tuned to the same model. Models like EOB have parameters which have been calibrated against numerical relativity in a certain region and with a certain accuracy. They have systematic errors, which grow increasingly significant when moving away from the region where they have been best-calibrated. For example, even for these binary parameters – deep inside a thoroughly-explored region of parameter space – we do not see this level of agreement when carrying out a similar analysis using other EOB models .">
  </outline>
  <outline text="Multi-mode, non-spinning EOB and NR" _note="In Figure   we show results for parameter estimation via ILE with EOBHM (solid red); via ILE with only the leading-order mode from EOBHM (dotted red); via ILEMC, with a surrogate which reproduces the mode of numerical relativity simulations (dotted green); via ILE, using the same surrogate model (dotted black); and with the same surrogate but including higher-order modes, via ILE (solid black). The top panels show a result with ; the bottom panels show results for a binary with . By design, both scenarios are comparable to cases examined in with a different parameter estimation engine (e.g., their Fig 9) using a similar model, albeit at higher SNR.  First and foremost, the bottom two panels show that, as with Figure  , ILEMC and ILE agree when the models do. We compare calculations performed using the same NR surrogate model, using ILE (black) and ILEMC (green) for parameter inference parameter inference. For example, in every panel the dotted black and green lines – two independent parameter inference methods using the modes of the NR surrogate – are in good agreement with one another.  Second, the bottom right panel shows by example that at this binary mass higher harmonics matter, since the dotted and solid lines do not agree. As illustrated clearly by directly comparable prior work like , higher harmonics break degeneracies and improve parameter estimation accuracy. The good agreement in the bottom panels of Figure   persists despite employing a completely different model for the source and template. Finally, in both the top and bottom panels of Figure  , we see generally good agreement between the red curves (PE with ILE, carried out using EOBHM) and the black curves (PE with ILE, carried out using our NR surrogate). Despite systematic differences between the NR surrogate and EOBHM, in most cases this agreement persists even when higher modes are omitted (dotted lines) or used (solid lines).  ">
  </outline>
</outline>
<outline text="Conclusions" _note="In this paper, we unified two strategies to accelerate parameter estimation – surrogate models and factored likelihoods – and implemented the result in a production-scale environment, ready-to-use on real LIGO data. Our code can be used with any (time-domain) linear surrogate model, leveraging parallel efforts to better model the multimodal gravitational wave signal from coalescing binaries .  With our existing implementation, we can rapidly reconstruct parameters of arbitrary sources whose runtime is mostly limited by the cost of a low-dimensional adaptive Monte Carlo integral. Based on operation counts, we project parameter estimates could be carried out in seconds to minutes. When operating at its theoretical limit, this approach can conceivably provide real-time parameter estimation and Bayesian evidence factors . These rapid calculations will be helpful to improve current detection procedures or to supplement investigations into the impact of non-Gaussian noise (“glitches”) on GW parameter estimation. Finally, as an illustration of our method’s broad utility, we have demonstrated how waveform modeling errors can, for sufficiently massive systems ( in dimensionless units), cause us to draw less sharp and reliable conclusions about the progenitor’s properties. Our method can make direct use of high-fidelity surrogate models trained on numerical relativity waveform data without any approximations to general relativity and including all harmonic modes resolved by the simulation. For heavy black holes in particular, where systematic biases are expected to be the most extreme , we demonstrate by example that modeling error such as neglecting higher harmonic modes can impact our interpretation of candidate events.">
</outline>
<outline text="Acknowledgments" _note="We acknowledge helpful discussions with Chad Galley and Rory Smith, Chad Galley for significant coding effort on the gwsurrogate project, and both anonymous reviewers for numerous helpful suggestions. R. O’Shaughnessy was supported by NSF PHY-1505629 and PHY 1607520. S. Field was partially supported by the NSF under award nos. TCAN AST-1333129 and PHY-1606654, and by the Sherman Fairchild Foundation. The group gratefully acknowledges Caltech and AEI-Hannover for computational resources.">
</outline>
  </body>
</opml>